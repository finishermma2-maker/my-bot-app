<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #f5f7fa; --card-bg: #ffffff; --text-main: #1d1d1f; --text-muted: #86868b;
            --accent-color: #ff6b4a; --gradient-start: #ff8e53; --gradient-end: #ff512f;
        }
        body {
            background-color: var(--bg-color); color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            margin: 0; padding: 16px; padding-bottom: 80px;
        }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; margin-top: 10px; }
        .header h1 { margin: 0; font-size: 24px; font-weight: 700; text-transform: capitalize; }
        
        /* –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã */
        .date-picker-btn {
            background: var(--card-bg); border: 1px solid #ddd; border-radius: 12px;
            padding: 8px 12px; font-size: 14px; display: flex; align-items: center; gap: 5px;
            cursor: pointer; position: relative;
        }
        .date-picker-btn input[type="date"] {
            position: absolute; opacity: 0; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;
        }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å-–ª–µ–Ω—Ç–∞ */
        .week-calendar {
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 10px;
            scrollbar-width: none;
        }
        .week-calendar::-webkit-scrollbar { display: none; }
        .day-card {
            min-width: 60px; padding: 12px 0; background: var(--card-bg); border-radius: 16px;
            text-align: center; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.02); transition: 0.2s;
        }
        .day-card.active { background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end)); color: white; }
        .day-card .weekday { font-size: 13px; margin-bottom: 4px; opacity: 0.7; }
        .day-card .day-num { font-size: 20px; font-weight: 700; }

        /* –¢–∞–π–º–ª–∞–π–Ω */
        .timeline-empty { text-align: center; padding: 40px 20px; color: var(--text-muted); }
        
        /* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */
        .fab-button {
            position: fixed; bottom: 24px; left: 16px; right: 16px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white; border: none; padding: 16px; border-radius: 20px;
            font-weight: 600; font-size: 16px; box-shadow: 0 10px 25px rgba(255, 81, 47, 0.3); z-index: 10;
        }

        /* –§–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏ */
        .add-form {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-color); z-index: 100; padding: 16px; overflow-y: auto;
        }
        .add-form.active { display: block; }
        input[type="text"], input[type="time"], textarea, select {
            width: 100%; padding: 16px; margin-bottom: 16px; border: 1px solid #e5e5ea;
            border-radius: 12px; font-size: 16px; box-sizing: border-box; background: #fff;
        }
        textarea { min-height: 100px; resize: none; }
    </style>
</head>
<body>
    
    <div id="dashboard">
        <div class="header">
            <h1 id="monthYearTitle">–ú–µ—Å—è—Ü</h1>
            <div class="date-picker-btn">
                üìÖ –í—ã–±—Ä–∞—Ç—å
                <input type="date" id="nativeDatePicker" onchange="jumpToDate(this.value)">
            </div>
        </div>

        <div class="week-calendar" id="calendarScroll">
            </div>

        <div class="timeline-empty">
            <h3 style="margin-bottom: 5px;">–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
            <p style="margin-top: 0; font-size: 14px;">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É.</p>
        </div>

        <button class="fab-button" onclick="openForm()">+ –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</button>
    </div>

    <div id="addForm" class="add-form">
        <div class="header">
            <h2>–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h2>
            <span style="font-size: 28px; color: var(--text-muted);" onclick="closeForm()">√ó</span>
        </div>
        
        <div id="selectedDateDisplay" style="margin-bottom: 15px; color: var(--accent-color); font-weight: bold;"></div>
        
        <input type="time" id="appTime" placeholder="–í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏">
        <input type="text" id="clientName" placeholder="–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞">
        <select id="service">
            <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É...</option>
            <option value="–°—Ç—Ä–∏–∂–∫–∞">–°—Ç—Ä–∏–∂–∫–∞</option>
            <option value="–û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ">–û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ</option>
            <option value="–°–ª–æ–∂–Ω–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ">–°–ª–æ–∂–Ω–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ</option>
            <option value="–£–∫–ª–∞–¥–∫–∞">–£–∫–ª–∞–¥–∫–∞</option>
        </select>
        <textarea id="notes" placeholder="–§–æ—Ä–º—É–ª–∞, –ø–æ–∂–µ–ª–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: –æ–∫—Å–∏–¥ 3%)"></textarea>
        
        <button class="fab-button" style="position: static; margin-top: 10px;" onclick="saveAppointment()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#f5f7fa');

        let currentDate = new Date();
        let selectedDateStr = "";

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è –Ω–∞ 90 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥
        function renderCalendar(startDate) {
            const scroll = document.getElementById('calendarScroll');
            scroll.innerHTML = '';
            
            const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
            const dayNames = ["–í—Å", "–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±"];
            
            document.getElementById('monthYearTitle').innerText = `${monthNames[startDate.getMonth()]} ${startDate.getFullYear()}`;

            for (let i = 0; i < 90; i++) {
                let d = new Date(startDate);
                d.setDate(d.getDate() + i);
                
                let dateString = d.toISOString().split('T')[0]; // –§–æ—Ä–º–∞—Ç YYYY-MM-DD
                let isToday = i === 0;

                let card = document.createElement('div');
                card.className = 'day-card' + (isToday ? ' active' : '');
                card.onclick = () => selectDay(card, dateString, d);
                
                card.innerHTML = `<div class="weekday">${dayNames[d.getDay()]}</div><div class="day-num">${d.getDate()}</div>`;
                scroll.appendChild(card);
                
                if (isToday) selectDay(card, dateString, d); // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            }
        }

        function selectDay(element, dateStr, dateObj) {
            document.querySelectorAll('.day-card').forEach(c => c.classList.remove('active'));
            element.classList.add('active');
            selectedDateStr = dateStr; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É!
            
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            document.getElementById('selectedDateDisplay').innerText = `–ó–∞–ø–∏—Å—å –Ω–∞: ${dateObj.toLocaleDateString('ru-RU', options)}`;
        }

        function jumpToDate(dateValue) {
            if(!dateValue) return;
            let jumpedDate = new Date(dateValue);
            renderCalendar(jumpedDate); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
        }

        function openForm() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('addForm').classList.add('active');
        }

        function closeForm() {
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('addForm').classList.remove('active');
        }

        function saveAppointment() {
            let time = document.getElementById('appTime').value;
            let name = document.getElementById('clientName').value;
            let service = document.getElementById('service').value;
            let notes = document.getElementById('notes').value;
            
            if(name && service && time) {
                let data = {
                    action: 'new_client',
                    date: selectedDateStr, // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ—á–Ω—É—é –¥–∞—Ç—É (YYYY-MM-DD)
                    time: time,            // –ò —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è (HH:MM)
                    name: name,
                    service: service,
                    notes: notes
                };
                tg.sendData(JSON.stringify(data));
                tg.close();
            } else {
                tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –í—Ä–µ–º—è, –ò–º—è –∏ –£—Å–ª—É–≥—É!");
            }
        }

        // –ó–∞–ø—É—Å–∫ —Å–æ –¥–Ω—è "–°–µ–≥–æ–¥–Ω—è"
        renderCalendar(new Date());
    </script>
</body>
</html>